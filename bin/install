#!/usr/bin/env bash
set -e

PLUGIN_NAME="swift-protobuf"
VERSION="$1"
INSTALL_PATH="$ASDF_INSTALL_PATH/$PLUGIN_NAME/$VERSION"

mkdir -p $INSTALL_PATH
cd $INSTALL_PATH

if ! command -v swift &> /dev/null; then
  echo "Swift is not installed. Please install Swift and try again."
  exit 1
fi

git clone https://github.com/apple/swift-protobuf.git
cd swift-protobuf
git fetch --all
git checkout tags/$VERSION

swift build -c release

cp .build/release/protoc-gen-swift $INSTALL_PATH/
chmod +x $INSTALL_PATH/protoc-gen-swift
